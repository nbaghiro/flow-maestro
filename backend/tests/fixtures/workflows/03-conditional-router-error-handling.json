{
    "name": "Conditional Router with Error Handling",
    "description": "Tests conditional branching: route to API or database based on source type",
    "entryPoint": "input-1",
    "nodes": {
        "input-1": {
            "type": "input",
            "name": "Start",
            "config": {},
            "position": { "x": 100, "y": 150 }
        },
        "conditional-1": {
            "type": "conditional",
            "name": "Route by Source",
            "config": {
                "leftValue": "${source}",
                "operator": "==",
                "rightValue": "api"
            },
            "position": { "x": 300, "y": 150 }
        },
        "http-1": {
            "type": "http",
            "name": "Fetch from API",
            "config": {
                "method": "GET",
                "url": "https://jsonplaceholder.typicode.com/users/1",
                "timeout": 10000,
                "retryCount": 2,
                "outputVariable": "apiData"
            },
            "position": { "x": 500, "y": 100 }
        },
        "database-1": {
            "type": "database",
            "name": "Fetch from Database",
            "config": {
                "provider": "postgresql",
                "operation": "query",
                "host": "localhost",
                "port": 5432,
                "database": "flowmaestro",
                "username": "flowmaestro",
                "password": "flowmaestro_dev_password",
                "query": "SELECT user_id, full_name, email, city, company FROM test_users WHERE user_id = 1",
                "outputVariable": "dbData"
            },
            "position": { "x": 500, "y": 250 }
        },
        "transform-1": {
            "type": "transform",
            "name": "Normalize Data",
            "config": {
                "operation": "custom",
                "inputData": "${apiData}",
                "expression": "{ \"userId\": $number(apiData.data.id), \"fullName\": apiData.data.name, \"email\": apiData.data.email, \"city\": apiData.data.address.city, \"company\": apiData.data.company.name, \"source\": \"api\" }",
                "outputVariable": "normalizedData"
            },
            "position": { "x": 700, "y": 100 }
        },
        "transform-2": {
            "type": "transform",
            "name": "Normalize DB Data",
            "config": {
                "operation": "custom",
                "inputData": "${dbData}",
                "expression": "{ \"userId\": $number(dbData.rows[0].user_id), \"fullName\": dbData.rows[0].full_name, \"email\": dbData.rows[0].email, \"city\": dbData.rows[0].city, \"company\": dbData.rows[0].company, \"source\": \"database\" }",
                "outputVariable": "normalizedData"
            },
            "position": { "x": 700, "y": 250 }
        },
        "output-1": {
            "type": "output",
            "name": "Result",
            "config": {
                "value": "${normalizedData}",
                "format": "json",
                "outputName": "result"
            },
            "position": { "x": 900, "y": 175 }
        }
    },
    "edges": [
        {
            "id": "e1",
            "source": "input-1",
            "target": "conditional-1"
        },
        {
            "id": "e3",
            "source": "conditional-1",
            "target": "http-1",
            "sourceHandle": "true"
        },
        {
            "id": "e4",
            "source": "conditional-1",
            "target": "database-1",
            "sourceHandle": "false"
        },
        {
            "id": "e5",
            "source": "http-1",
            "target": "transform-1"
        },
        {
            "id": "e6",
            "source": "database-1",
            "target": "transform-2"
        },
        {
            "id": "e7",
            "source": "transform-1",
            "target": "output-1"
        },
        {
            "id": "e8",
            "source": "transform-2",
            "target": "output-1"
        }
    ]
}
